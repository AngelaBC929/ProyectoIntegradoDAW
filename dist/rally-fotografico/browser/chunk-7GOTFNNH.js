import{a as z}from"./chunk-KAMHYRVC.js";import{u as E}from"./chunk-NIRNFEWH.js";import{$ as s,A as m,B as b,M as x,Na as v,O as l,Oa as y,S as g,Sa as w,T as O,Va as k,X as _,a as C,ab as S,b as M,da as o,ea as e,eb as I,fa as f,fb as U,ia as P,ka as p,la as d,ra as n,sa as h,ta as u}from"./chunk-Q43MG4T7.js";function F(c,i){if(c&1){let t=P();o(0,"tr")(1,"td"),f(2,"img",8),e(),o(3,"td"),n(4),e(),o(5,"td"),n(6),e(),o(7,"td"),n(8),e(),o(9,"td"),n(10),e(),o(11,"td")(12,"button",9),p("click",function(){let a=m(t).$implicit,T=d();return b(T.openModal(a))}),n(13),e()()()}if(c&2){let t=i.$implicit,r=d();l(2),s("src",t.photo_url,x),l(2),h(t.user_name||"Sin nombre"),l(2),h(t.title||"Sin t\xEDtulo"),l(2),h(t.rally_name||"Sin rally"),l(2),h(t.status),l(2),s("disabled",t.status==="aprobada"||t.status==="rechazada"||r.hasRallyEnded(t)),l(),u(" ",r.hasRallyEnded(t)?"Rally finalizado":"Revisar"," ")}}function V(c,i){if(c&1){let t=P();o(0,"div",10)(1,"div",11)(2,"h3"),n(3,"Revisi\xF3n de Foto"),e(),f(4,"img",12),o(5,"p")(6,"strong"),n(7,"Usuario:"),e(),n(8),e(),o(9,"p")(10,"strong"),n(11,"T\xEDtulo:"),e(),n(12),e(),o(13,"p")(14,"strong"),n(15,"Rally:"),e(),n(16),e(),o(17,"div",13)(18,"button",14),p("click",function(){m(t);let a=d();return b(a.updatePhotoStatus("aprobada"))}),n(19,"Aprobar"),e(),o(20,"button",14),p("click",function(){m(t);let a=d();return b(a.updatePhotoStatus("rechazada"))}),n(21,"Rechazar"),e(),o(22,"button",14),p("click",function(){m(t);let a=d();return b(a.closeModal())}),n(23,"Cancelar"),e()()()()}if(c&2){let t=d();l(4),s("src",t.selectedPhoto==null?null:t.selectedPhoto.photo_url,x),l(4),u(" ",t.selectedPhoto==null?null:t.selectedPhoto.user_name,""),l(4),u(" ",t.selectedPhoto==null?null:t.selectedPhoto.title,""),l(4),u(" ",t.selectedPhoto==null?null:t.selectedPhoto.rally_name,"")}}var R=class c{constructor(i,t,r,a){this.http=i;this.router=t;this.photoService=r;this.rallyService=a}allPhotos=[];isModalOpen=!1;selectedPhoto=null;apiUrl=I.apiUrl;rallies=[];ngOnInit(){this.loadRallies()}loadRallies(){this.rallyService.getAllRallies().subscribe(i=>{this.rallies=i,this.loadPhotos()})}loadPhotos(){this.http.get(`${this.apiUrl}/fotos.php?action=getAllPhotos`).subscribe(i=>{i.photos?this.allPhotos=i.photos.map(t=>{let r=this.rallies.find(a=>a.title===t.rally_name);return M(C({},t),{photo_url:`${this.apiUrl}/${t.photo_url}`,rally:r})}):console.error("No se encontraron fotos")},i=>{console.error("Error al cargar fotos",i)})}openModal(i){this.selectedPhoto=i,this.isModalOpen=!0}closeModal(){this.isModalOpen=!1,this.selectedPhoto=null}updatePhotoStatus(i){this.selectedPhoto?(console.log("Enviando solicitud con estos datos:",{photo_id:this.selectedPhoto.id,status:i}),this.photoService.updatePhotoStatus(this.selectedPhoto.id,i).subscribe(t=>{if(t.success){this.selectedPhoto.status=i,this.selectedPhoto.isReviewed=!0;let r=this.allPhotos.findIndex(a=>a.id===this.selectedPhoto.id);r!==-1&&(this.allPhotos[r].status=i),this.closeModal()}else console.error("Error al actualizar el estado de la foto")},t=>{console.error("Error en la solicitud HTTP",t)})):console.error("No se ha seleccionado ninguna foto")}hasRallyEnded(i){let t=i.rally;if(!t||!t.end_date)return!1;let r=new Date,a=new Date(t.end_date);return r>a}goBackToAdminPanel(){this.router.navigate(["admin"])}static \u0275fac=function(t){return new(t||c)(g(k),g(S),g(U),g(z))};static \u0275cmp=O({type:c,selectors:[["app-user-photos"]],decls:26,vars:2,consts:[[1,"photo-list"],[1,"table-container"],[1,"table-responsive"],["cellspacing","0","cellpadding","8",1,"table"],[4,"ngFor","ngForOf"],[1,"button-container"],[1,"back-button",3,"click"],["class","modal-overlay",4,"ngIf"],["alt","Foto",3,"src"],[3,"click","disabled"],[1,"modal-overlay"],[1,"modal-content"],["alt","Foto seleccionada",1,"modal-image",3,"src"],[1,"modal-buttons"],[3,"click"]],template:function(t,r){t&1&&(o(0,"div",0)(1,"h2"),n(2,"Fotos de usuarios"),e(),o(3,"div",1)(4,"div",2)(5,"table",3)(6,"thead")(7,"tr")(8,"th"),n(9,"Foto"),e(),o(10,"th"),n(11,"Usuario"),e(),o(12,"th"),n(13,"Nombre de la foto"),e(),o(14,"th"),n(15,"Rally"),e(),o(16,"th"),n(17,"Estado"),e(),o(18,"th"),n(19,"Acciones"),e()()(),o(20,"tbody"),_(21,F,14,7,"tr",4),e()()(),o(22,"div",5)(23,"button",6),p("click",function(){return r.goBackToAdminPanel()}),n(24,"Volver"),e()()()(),_(25,V,24,4,"div",7)),t&2&&(l(21),s("ngForOf",r.allPhotos),l(4),s("ngIf",r.isModalOpen))},dependencies:[w,v,y,E],styles:[".table-container[_ngcontent-%COMP%]{max-width:900px;margin:40px auto;background-color:#f2d388;border:2px solid #7b4f24;border-radius:12px;padding:20px 30px;box-shadow:0 6px 14px #d2a04673;font-family:Georgia,serif;color:#4b2e05}.table-responsive[_ngcontent-%COMP%]{overflow-x:auto;max-width:100%;overflow-y:hidden}h2[_ngcontent-%COMP%]{font-size:2.5rem;margin-bottom:1rem;color:#7b4f24;text-align:center;text-shadow:1px 1px 2px #7b4f24}.table[_ngcontent-%COMP%]{width:100%;border-collapse:separate;border-spacing:0 12px;border:none}.table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background-color:#f2d388;text-align:left;padding:12px 15px;font-size:1.1rem;border-bottom:3px solid #a06937;color:#4b2e05;text-shadow:1px 1px 2px #7b4f24;border-radius:8px 8px 0 0}.table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{background-color:#f9e3b0;border-radius:10px;box-shadow:0 2px 5px #7b4f2426;transition:background-color .3s ease}.table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:nth-child(2n){background-color:#f4d77a}.table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background-color:#ebcb80;box-shadow:0 6px 15px #d2a04666}.table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:10px;vertical-align:middle;font-size:1rem;color:#4b2e05;border:none;white-space:normal;word-break:break-word}.table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{max-width:100px;height:auto;border-radius:6px;display:block}.table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{font-family:Georgia,serif;font-weight:700;background-color:#7b4f24;color:#f9f4e6;border:none;padding:6px 14px;border-radius:8px;cursor:pointer;font-size:.95rem;transition:background-color .3s ease,box-shadow .3s ease;box-shadow:0 2px 5px #7b4f2466;-webkit-user-select:none;user-select:none;min-width:80px;white-space:nowrap}.table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:disabled{background-color:#c0b59f;cursor:default;box-shadow:none;color:#7b6f5a}.table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover:not(:disabled){background-color:#a06937;box-shadow:0 4px 10px #a0693799}.button-container[_ngcontent-%COMP%]{margin-top:25px;text-align:center}.back-button[_ngcontent-%COMP%]{font-family:Georgia,serif;font-weight:700;background-color:#7b4f24;color:#f9f4e6;border:none;padding:10px 28px;border-radius:12px;cursor:pointer;font-size:1.1rem;box-shadow:0 4px 10px #7b4f2499;transition:background-color .3s ease,box-shadow .3s ease}.back-button[_ngcontent-%COMP%]:hover{background-color:#a06937;color:#fff;box-shadow:0 6px 14px #a06937cc}.modal-overlay[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;background-color:#00000080;display:flex;justify-content:center;align-items:center;z-index:1000}.modal-content[_ngcontent-%COMP%]{max-width:400px;background-color:#fff8ec;padding:25px;border-radius:12px;width:90%;box-shadow:0 6px 18px #0000004d;text-align:center}.modal-content[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin-bottom:15px;color:#7b4f24;font-size:1.5rem}.modal-image[_ngcontent-%COMP%]{max-width:100%;height:auto;margin-bottom:15px;border-radius:8px}.modal-buttons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin:8px;padding:10px 18px;border:none;border-radius:8px;font-family:Georgia,serif;font-weight:700;font-size:1rem;cursor:pointer;transition:background-color .3s ease}.modal-buttons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:nth-child(1){background-color:#4caf50;color:#fff}.modal-buttons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:nth-child(2){background-color:#f44336;color:#fff}.modal-buttons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:nth-child(3){background-color:#7b4f24;color:#fff8ec}.modal-buttons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{opacity:.9}@media (max-width: 768px){.table-container[_ngcontent-%COMP%]{padding:15px;margin:20px auto}.table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:10px 12px;font-size:.9rem}.table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{max-width:80px}.table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{font-size:.85rem;padding:6px 10px;min-width:70px}.back-button[_ngcontent-%COMP%]{font-size:1rem;padding:10px 22px}.modal-content[_ngcontent-%COMP%]{width:95%;padding:20px}.modal-content[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:1.3rem}.modal-buttons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{font-size:.95rem;padding:8px 14px}}"]})};export{R as UserPhotosComponent};
