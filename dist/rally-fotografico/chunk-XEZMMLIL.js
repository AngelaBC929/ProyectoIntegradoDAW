import{a as H,b as Q,c as J,d as K,e as X,f as Z,g as $,h as ee,i as te,j as ne,k as ie}from"./chunk-2ET7OYAK.js";import{a as Y}from"./chunk-7L3QPRQ3.js";import{b as V,d as N,e as U,f as j,g as L,h as q,u as B}from"./chunk-NIRNFEWH.js";import{$ as c,A as g,B as u,M as S,Na as D,O as s,Oa as F,S as b,Sa as I,T as w,Va as T,X as f,a as O,ab as A,ba as h,bb as z,da as t,db as R,ea as e,eb as W,fa as _,fb as G,ga as y,ha as E,ia as M,ka as p,la as d,ra as n,ua as k,va as C,wa as v,xa as P,za as x}from"./chunk-Q43MG4T7.js";var oe=()=>["/mis-rallies"],ae=()=>["/mis-fotos"],le=()=>["/faqs"],se=()=>({responsive:!0});function ce(l,o){if(l&1&&(t(0,"li"),n(1),e()),l&2){let i=o.$implicit;s(),k(" ",i.title," : ",i.inscritos," participantes ")}}function de(l,o){l&1&&(t(0,"p"),n(1,"No hay rallies con inscritos todav\xEDa."),e())}function me(l,o){if(l&1&&(y(0),t(1,"div",18),_(2,"canvas",19),e(),E()),l&2){let i=d();s(2),c("data",i.barChartData)("type",i.barChartType)("options",x(3,se))}}function pe(l,o){if(l&1){let i=M();t(0,"div",24)(1,"h2"),n(2,"Mis datos"),e(),t(3,"label"),n(4,"Nombre"),e(),t(5,"input",25),P("ngModelChange",function(r){g(i);let m=d(2);return v(m.usuario.name,r)||(m.usuario.name=r),u(r)}),e(),t(6,"label"),n(7,"Apellidos"),e(),t(8,"input",25),P("ngModelChange",function(r){g(i);let m=d(2);return v(m.usuario.lastName,r)||(m.usuario.lastName=r),u(r)}),e(),t(9,"label"),n(10,"Correo Electr\xF3nico"),e(),t(11,"input",26),P("ngModelChange",function(r){g(i);let m=d(2);return v(m.usuario.email,r)||(m.usuario.email=r),u(r)}),e(),t(12,"button",27),p("click",function(){g(i);let r=d(2);return u(r.modificarPerfil())}),n(13,"Guardar cambios"),e()()}if(l&2){let i=d(2);s(5),C("ngModel",i.usuario.name),s(3),C("ngModel",i.usuario.lastName),s(3),C("ngModel",i.usuario.email)}}function ge(l,o){if(l&1&&(t(0,"section",20),f(1,pe,14,3,"div",21),t(2,"div",22)(3,"h2"),n(4,"Subida de Fotos"),e(),t(5,"p"),n(6,"\u2022 Puedes subir hasta "),t(7,"strong"),n(8,"3 fotos"),e(),n(9," por rally. Aseg\xFArate de que sigan la tem\xE1tica y cumplan las normas."),e(),t(10,"p"),n(11,"\u2022 Tu foto puede ser "),t(12,"strong"),n(13,"admitida"),e(),n(14,", quedar "),t(15,"strong"),n(16,"pendiente"),e(),n(17," o ser "),t(18,"strong"),n(19,"rechazada"),e(),n(20," tras revisi\xF3n del administrador. "),e(),t(21,"p"),n(22,"\u2022 Podr\xE1s seguir subiendo tus fotos mientras no llegues al l\xEDmite(recuerda:3 fotos por rally) y podr\xE1s votar tus fotos favoritas mientras el rally este "),t(23,"strong"),n(24,"activo"),e(),n(25,"."),e(),t(26,"p"),n(27,"\u2022 Podr\xE1s "),t(28,"strong"),n(29,"modificar"),e(),n(30," o "),t(31,"strong"),n(32,"eliminar"),e(),n(33," una foto mientras que no haya sido aceptada"),e(),t(34,"P"),n(35,"\u2022 Si la foto ha sido "),t(36,"strong"),n(37,"aceptada"),e(),n(38," solo podr\xE1s modificar su "),t(39,"strong"),n(40,"nombre"),e(),n(41,"."),e(),t(42,"p"),n(43,"\u2022 Consulta las "),t(44,"a",23),n(45,"FAQs"),e(),n(46," para m\xE1s detalles."),e()()()),l&2){let i=d();s(),c("ngIf",i.usuario)}}function ue(l,o){if(l&1&&(t(0,"div",36)(1,"h3"),n(2,"Vista previa:"),e(),_(3,"img",37),e()),l&2){let i=d(2);s(3),c("src",i.imagePreview,S)}}function fe(l,o){if(l&1){let i=M();t(0,"div",28)(1,"div",29)(2,"span",30),p("click",function(){g(i);let r=d();return u(r.closeModal())}),n(3,"\xD7"),e(),t(4,"h2"),n(5,"Sube tu foto"),e(),t(6,"form",31),p("ngSubmit",function(){g(i);let r=d();return u(r.onSubmit())}),t(7,"label",32),n(8,"Selecciona una foto:"),e(),t(9,"input",33),p("change",function(r){g(i);let m=d();return u(m.onFileSelected(r))}),e(),f(10,ue,4,1,"div",34),t(11,"button",35),n(12,"Subir Foto"),e()()()()}if(l&2){let i=d();s(10),c("ngIf",i.imagePreview),s(),c("disabled",!i.selectedFile)}}K.register(J,X,te,ne,$,ee,Z);var re=class l{constructor(o,i,a,r,m,be){this.router=o;this.userService=i;this.photoService=a;this.sweetAlert=r;this.http=m;this.authenticationService=be}tabActivo="perfil";usuario=null;tituloFoto="";topRallies=[];isModalOpen=!1;selectedFile=null;imagePreview=null;errorMessage="";barChartData={labels:[],datasets:[{data:[],label:"Inscritos",backgroundColor:"#7b4f24"}]};barChartType="bar";ngOnInit(){let o=localStorage.getItem("userId");o?this.userService.getUserById(+o).subscribe({next:i=>{this.usuario=i},error:i=>{console.error("Error cargando el usuario:",i)}}):this.router.navigate(["/login"]),this.cargarTopRallies()}seleccionarTab(o){this.tabActivo=o}cargarTopRallies(){let o=`${W.apiUrl}/inscripciones.php?stats=top`;this.http.get(o).subscribe({next:i=>{i.success?(this.topRallies=i.topRallies,this.updateChartData()):this.errorMessage=i.message||"Error al cargar datos."},error:i=>{this.errorMessage="Error en la llamada a la API.",console.error("Error HTTP:",i)}})}updateChartData(){this.barChartData={labels:this.topRallies.map(o=>o.title),datasets:[{data:this.topRallies.map(o=>o.inscritos),label:"Inscritos",backgroundColor:"#7b4f24"}]}}openModal(){this.isModalOpen=!0}closeModal(){this.isModalOpen=!1,this.selectedFile=null,this.imagePreview=null}onFileSelected(o){let i=o.target.files[0];if(i){this.selectedFile=i;let a=new FileReader;a.onload=r=>{this.imagePreview=r.target.result},a.readAsDataURL(i)}}onSubmit(){if(this.selectedFile&&this.usuario){let o=this.usuario.id,i=456,a=this.tituloFoto||"Sin t\xEDtulo";this.photoService.uploadPhoto(this.selectedFile,o,i,a).subscribe({next:()=>{this.sweetAlert.success("Foto subida correctamente"),this.closeModal()},error:r=>{console.error("Error al subir la foto:",r),this.sweetAlert.error("Error","Error al subir la foto")}})}else this.sweetAlert.info("Por favor selecciona una foto.")}modificarPerfil(){if(this.usuario){let o=O({},this.usuario);this.userService.updateUser(this.usuario.id,o).subscribe({next:()=>{this.sweetAlert.success("Perfil actualizado correctamente"),this.authenticationService.setUsername(o.name)},error:()=>{this.sweetAlert.error("Error","No se pudo actualizar el perfil")}})}}entrarProximosRallies(){this.router.navigate(["/proximos-rallies"])}entrarRalliesActuales(){this.router.navigate(["/rallies-actuales"])}entrarRalliesPasados(){this.router.navigate(["/rallies-pasados"])}entrarGaleria(){this.router.navigate(["/gallery"],{queryParams:{from:"dashboard"}})}goBackToUserPanel(){this.router.navigate(["user/dashboard"])}static \u0275fac=function(i){return new(i||l)(b(A),b(G),b(Q),b(Y),b(T),b(H))};static \u0275cmp=w({type:l,selectors:[["app-dashboard"]],decls:53,vars:21,consts:[[1,"dashboard"],[1,"dashboard-header"],[1,"tabs"],[3,"click"],[3,"routerLink"],[1,"user-dashboard"],[1,"card-container"],[1,"card"],["src","images/carrete.png","alt","carrete",1,"icono-rally-carrete"],[1,"btn-enter",3,"click"],["src","images/camara.png","alt","camara",1,"icono-rally-camara"],["src","images/foto.png","alt","foto",1,"icono-rally-foto"],[1,"card","card-stats"],[4,"ngFor","ngForOf"],[4,"ngIf"],[1,"card","card-graph"],["class","perfil-container",4,"ngIf"],["id","uploadModal","class","modal",4,"ngIf"],[1,"chart-wrapper"],["baseChart","",3,"data","type","options"],[1,"perfil-container"],["class","perfil-card",4,"ngIf"],[1,"fotos-card"],["routerLink","/faqs"],[1,"perfil-card"],["type","text",3,"ngModelChange","ngModel"],["type","email",3,"ngModelChange","ngModel"],[1,"btn-guardar",3,"click"],["id","uploadModal",1,"modal"],[1,"modal-content"],[1,"close",3,"click"],[3,"ngSubmit"],["for","photoInput"],["type","file","id","photoInput","name","photo","accept","image/*",3,"change"],["id","previewContainer",4,"ngIf"],["type","submit",3,"disabled"],["id","previewContainer"],["alt","Vista previa",3,"src"]],template:function(i,a){i&1&&(t(0,"div",0)(1,"header",1)(2,"h1"),n(3,"Bienvenido a tu Panel de Usuario"),e(),t(4,"nav",2)(5,"button",3),p("click",function(){return a.seleccionarTab("perfil")}),n(6,"Perfil"),e(),t(7,"button",4),n(8,"Mis Rallies"),e(),t(9,"button",4),n(10,"Mis Fotos"),e(),t(11,"button",3),p("click",function(){return a.entrarGaleria()}),n(12,"Galer\xEDa"),e(),t(13,"button",4),n(14,"FAQs"),e()()(),t(15,"div",5)(16,"div",6)(17,"div",7)(18,"h2"),n(19,"Pr\xF3ximos Rallies "),_(20,"img",8),e(),t(21,"p"),n(22,"Participa en los pr\xF3ximos rallies fotogr\xE1ficos que tenemos preparados para ti."),e(),t(23,"button",9),p("click",function(){return a.entrarProximosRallies()}),n(24,"Entrar"),e()(),t(25,"div",7)(26,"h2"),n(27,"Rallies Actuales "),_(28,"img",10),e(),t(29,"p"),n(30,"\xDAnete a los rallies en los que est\xE1s participando actualmente."),e(),t(31,"button",9),p("click",function(){return a.entrarRalliesActuales()}),n(32,"Entrar"),e()(),t(33,"div",7)(34,"h2"),n(35,"Rallies Finalizados "),_(36,"img",11),e(),t(37,"p"),n(38,"Revive los rallies pasados y mira las fotos que tomaste."),e(),t(39,"button",9),p("click",function(){return a.entrarRalliesPasados()}),n(40,"Entrar"),e()()()(),t(41,"div",6)(42,"div",12)(43,"h2"),n(44,"Rallies con m\xE1s participaci\xF3n"),e(),t(45,"ul"),f(46,ce,2,2,"li",13),e(),f(47,de,2,0,"p",14),e(),t(48,"div",15),f(49,me,3,4,"ng-container",14),e()(),t(50,"main"),f(51,ge,47,1,"section",16),e(),f(52,fe,13,2,"div",17),e()),i&2&&(s(5),h("active",a.tabActivo==="perfil"),s(2),h("active",a.tabActivo==="misrallies"),c("routerLink",x(18,oe)),s(2),h("active",a.tabActivo==="misfotos"),c("routerLink",x(19,ae)),s(2),h("active",a.tabActivo==="gallery"),s(2),h("active",a.tabActivo==="faqs"),c("routerLink",x(20,le)),s(33),c("ngForOf",a.topRallies),s(),c("ngIf",a.topRallies.length===0),s(2),c("ngIf",a.barChartData),s(2),c("ngIf",a.tabActivo==="perfil"),s(),c("ngIf",a.isModalOpen))},dependencies:[I,D,F,B,q,V,N,U,L,j,R,z,ie],styles:[".dashboard[_ngcontent-%COMP%]{font-family:Segoe UI,Tahoma,Geneva,Verdana,sans-serif;background:url(/images/fondo3.jpg) no-repeat center top;background-size:cover;color:#4b2e05;min-height:90vh;padding:1rem 2rem 3rem}.dashboard-header[_ngcontent-%COMP%]{background-color:#7b4f24;color:#f9f4e6;padding:1.5rem 2rem;border-radius:8px;box-shadow:0 4px 10px #7b4f2480;margin-bottom:1.5rem;-webkit-user-select:none;user-select:none}.dashboard-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0 0 .8rem;font-weight:700;font-size:2rem;text-shadow:1px 1px 4px #3c2608}.tabs[_ngcontent-%COMP%]{display:flex;gap:1rem}.tabs[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{background:transparent;border:none;color:#e0cda9;font-weight:600;font-size:1rem;padding:.5rem 1rem;border-bottom:3px solid transparent;cursor:pointer;transition:color .3s ease,border-bottom-color .3s ease}.tabs[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{color:#fff6d6}.tabs[_ngcontent-%COMP%]   button.active[_ngcontent-%COMP%]{border-bottom-color:#f2d388;color:#f9f4e6;font-weight:700}.card[_ngcontent-%COMP%]{flex:1;background:#f2d388;padding:1.8rem;border-radius:12px;box-shadow:0 6px 14px #d2a04673;color:#4b2e05;display:flex;flex-direction:column;justify-content:space-between;transition:transform .3s ease;cursor:pointer}.card[_ngcontent-%COMP%]:hover{transform:translateY(-5px);box-shadow:0 10px 20px #d2a04699}.card[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{text-align:center;margin-top:-1rem;font-weight:700;font-size:1.4rem;text-shadow:1px 1px 2px #7b4f24}.card[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:.8rem 0 1.5rem;font-size:1rem;line-height:1.3}.btn-enter[_ngcontent-%COMP%], .btn-guardar[_ngcontent-%COMP%]{background-color:#7b4f24;color:#f9f4e6;border:none;padding:.6rem 1.4rem;font-size:1rem;font-weight:700;border-radius:8px;transition:background-color .3s ease;cursor:pointer;align-items:center}.btn-enter[_ngcontent-%COMP%]:hover, .btn-guardar[_ngcontent-%COMP%]:hover{background-color:#a06937}.perfil-container[_ngcontent-%COMP%]{display:flex;gap:1.5rem;flex-wrap:nowrap;justify-content:space-between;padding:1rem 0}.perfil-card[_ngcontent-%COMP%], .fotos-card[_ngcontent-%COMP%]{flex:0 0 48%;background:#fdf7e3;border-radius:12px;padding:1rem 1.2rem;box-shadow:0 4px 10px #7b4f2440;color:#4b2e05;display:flex;flex-direction:column;font-size:.95rem}.perfil-card[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%], .fotos-card[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-weight:700;margin-bottom:1rem;text-shadow:1px 1px 3px #7b4f24}.perfil-card[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{margin-top:1rem;font-weight:600;font-size:1rem}.perfil-card[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{margin-top:.4rem;margin-bottom:.2rem;padding:.5rem .7rem;font-size:1rem;border:1.5px solid #d6a643;border-radius:6px;outline:none;transition:border-color .3s ease;color:#4b2e05;background-color:#fef9e7}.perfil-card[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus{border-color:#b68c2f}.fotos-card[_ngcontent-%COMP%]{flex:0 0 48%;background:#fff9ec;border-radius:14px;padding:2rem;box-shadow:0 6px 14px #d2a04666;color:#4b2e05;display:flex;flex-direction:column;font-size:1.05rem;line-height:1.6;transition:box-shadow .3s ease}.fotos-card[_ngcontent-%COMP%]:hover{box-shadow:0 10px 22px #d2a0468c}.fotos-card[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:2rem;font-weight:700;margin-bottom:1.2rem;color:#4b2e05;text-shadow:1px 1px 3px #7b4f24;display:flex;align-items:center;gap:.5rem}.fotos-card[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{list-style:none;padding-left:0}.fotos-card[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{position:relative;padding-left:1.5rem;margin-bottom:1rem;color:#5e3c10;font-size:1rem}.fotos-card[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{margin-top:.5rem;margin-left:1rem;list-style:disc;color:#5e3c10;font-size:.95rem}.fotos-card[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{margin-bottom:.3rem;padding-left:1rem}.fotos-card[_ngcontent-%COMP%]   .btn-accion[_ngcontent-%COMP%]{margin-top:auto;align-self:flex-start;background-color:#7b4f24;color:#f9f4e6;padding:.6rem 1.4rem;font-size:1rem;font-weight:700;border:none;border-radius:8px;cursor:pointer;transition:background-color .3s ease;margin-top:2rem}.fotos-card[_ngcontent-%COMP%]   .btn-accion[_ngcontent-%COMP%]:hover{background-color:#a06937}.modal[_ngcontent-%COMP%]{position:fixed;z-index:1000;left:0;top:0;width:100%;height:100%;overflow:auto;background-color:#00000080;display:flex;justify-content:center;align-items:center}.modal-content[_ngcontent-%COMP%]{background-color:#fff9ef;padding:2rem;border:2px solid #7b4f24;border-radius:10px;width:90%;max-width:500px;box-shadow:0 6px 20px #0006;position:relative;color:#4b2e05}.icono-rally-carrete[_ngcontent-%COMP%]{width:85px;height:auto;vertical-align:middle}.icono-rally-foto[_ngcontent-%COMP%]{width:80px;height:auto;margin:0 auto 0 10px;vertical-align:middle}.icono-rally-camara[_ngcontent-%COMP%]{width:85px;height:auto;margin:0 auto 0 10px;vertical-align:middle}.close[_ngcontent-%COMP%]{position:absolute;top:1rem;right:1rem;color:#a4423b;font-size:1.5rem;font-weight:700;cursor:pointer}.close[_ngcontent-%COMP%]:hover{color:#721c24}#previewContainer[_ngcontent-%COMP%]{margin:1rem 0}#previewContainer[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{max-width:100%;border-radius:6px;border:2px solid #d6a643;box-shadow:0 2px 6px #7b4f244d}.card-container[_ngcontent-%COMP%]{display:flex;gap:2rem;margin-bottom:2rem;align-items:stretch}.card-stats[_ngcontent-%COMP%], .card-graph[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;min-height:200px}.card-stats[_ngcontent-%COMP%]{margin-top:2.5rem;background-color:#f2d388;padding:1.25rem 1.5625rem;border-radius:.5rem;box-sizing:border-box}.card-stats[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin-top:2rem;margin-bottom:.5rem;font-size:1.8rem;font-weight:700;color:#4b2e05;text-shadow:1px 1px 3px #7b4f24;text-align:center}.card-stats[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{list-style:none;padding-left:0;margin:0}.card-stats[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{display:flex;margin-bottom:12px;font-weight:600;font-size:1.25rem;color:#3c3c3c;line-height:1.4;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.card-graph[_ngcontent-%COMP%]{background-color:#f2d388;padding:1.25rem 1.5625rem;border-radius:.5rem;box-sizing:border-box;display:flex;flex-direction:column;justify-content:center}.chart-wrapper[_ngcontent-%COMP%]{flex:1;display:flex;align-items:center;justify-content:center}.card-graph[_ngcontent-%COMP%]   canvas[_ngcontent-%COMP%]{width:100%!important;height:100%!important;max-height:300px;object-fit:contain}@media (max-width: 1024px){.card-container[_ngcontent-%COMP%]{flex-direction:column;gap:1.5rem}.perfil-container[_ngcontent-%COMP%]{flex-direction:column;gap:1rem}.perfil-card[_ngcontent-%COMP%], .fotos-card[_ngcontent-%COMP%]{flex:1 1 100%}.dashboard-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:1.5rem}.tabs[_ngcontent-%COMP%]{flex-wrap:wrap}.tabs[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{flex:1 1 45%;margin-bottom:.5rem}}@media (max-width: 600px){.dashboard[_ngcontent-%COMP%], .dashboard-header[_ngcontent-%COMP%]{padding:1rem}.card[_ngcontent-%COMP%]{padding:1.2rem}.card[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:1.2rem}.btn-enter[_ngcontent-%COMP%], .btn-guardar[_ngcontent-%COMP%]{padding:.5rem 1rem;font-size:.9rem}.fotos-card[_ngcontent-%COMP%]{padding:1.5rem;font-size:.95rem}.icono-rally-carrete[_ngcontent-%COMP%], .icono-rally-camara[_ngcontent-%COMP%], .icono-rally-foto[_ngcontent-%COMP%]{width:50px}}"]})};export{re as DashboardComponent};
